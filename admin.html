<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="estilos.css" />
</head>
<body>

    <header>
        <h1>Hotel Elegance</h1>
        <span>Sistema de Reservas</span>
    </header>

    <nav>
        <a href="index.html">Seleccionar Habitaciones</a>
        <a id="refReservas" href="reservas.html">Resumen y Reserva</a>
        <a href="admin.html" class="active">Administración</a>
    </nav>
    <main>
        <section class="estadisticas">
            <div class="card azul">
                <i class="fa-solid fa-building-circle-check"></i>
                <h2>Habitaciones Disponibles</h2>
                <p class="can-disponibles">35</p>
            </div>
            <div class="card rojo">
                <i class="fa-solid fa-building-circle-xmark"></i>
                <h2>Habitaciones Ocupadas</h2>
                <p class="can-ocupadas">15</p>
            </div>
            <div class="card verde">
                <i class="fa-solid fa-calendar"></i>
                <h2>Total Reservas</h2>
                <p class="can-reservas">3</p>
            </div>
            <div class="card dorado">
                <i class="fa-solid fa-sack-dollar"></i>
                <h2>Ingresos Totales</h2>
                <p class="ingresos">$28,200</p>
            </div>
        </section>

        <section class="disponibilidad">
            <h3>Disponibilidad</h3>

            <div class="categoria standard">
                <i class="fa-solid fa-bed"></i>
                <span>Standard</span>
                <div class="barra standard"><div></div></div>
                <span class="detalle">11 / 20 (55%)</span>
            </div>

            <div class="categoria deluxe">
                <i class="fa-solid fa-couch"></i>
                <span>Deluxe</span>
                <div class="barra deluxe"><div></div></div>
                <span class="detalle">1 / 15 (7%)</span>
            </div>

            <div class="categoria suite">
                <i class="fa-solid fa-crown"></i>
                <span>Suite</span>
                <div class="barra suite"><div></div></div>
                <span class="detalle">2 / 10 (20%)</span>
            </div>

            <div class="categoria presidencial">
                <i class="fa-solid fa-gem"></i>
                <span>Presidencial</span>
                <div class="barra presidencial"><div></div></div>
                <span class="detalle">1 / 5 (20%)</span>
            </div>
        </section>

        <section class="historial">

            <div class="header">
                <h3>Historial de Reservas</h3>
                <button class="btn-reiniciar">Resetear Todo</button>
            </div>

            <!--<div class="reserva">
                <p class="nombre">sada</p>
                <p class="fecha">11/12/2025 - 11/12/2026</p>
                <div class="habitaciones">
                    <span>101</span><span>102</span><span>103</span><span>104</span><span>105</span>
                </div>
                <p class="total-ref">$6000</p>
                <i class="fa-solid fa-trash"></i>
            </div>
            <div class="reserva">
                <p class="nombre">sada</p>
                <p class="fecha">11/12/2025 - 11/12/2026</p>
                <div class="habitaciones">
                    <span>101</span><span>102</span><span>103</span><span>104</span><span>105</span>
                </div>
                <p class="total-ref">$6000</p>
                <i class="fa-solid fa-trash"></i>
            </div>-->
        </section>
    </main>
    <script>
        const reservas = JSON.parse(localStorage.getItem("reservas")) || [];
        const habitacionesReservadas = JSON.parse(localStorage.getItem("habitacionesReservadas")) || [];
        const contenedorHistorial = document.querySelector(".historial");

        console.log(reservas);
        console.log(habitacionesReservadas);


        function cargarDatos() {
            const ocupadas = habitacionesReservadas.length;
            const disponibles = 50 - ocupadas;
            const totalReservas = reservas.length;
            const ingresosTotales = reservas.reduce((a, b) => a + b.total, 0);


            document.querySelector(".can-disponibles").textContent = disponibles;
            document.querySelector(".can-ocupadas").textContent = ocupadas;
            document.querySelector(".can-reservas").textContent = totalReservas;
            document.querySelector(".ingresos").textContent = `$${ingresosTotales}`;

            contenedorHistorial.replaceChildren();
            contenedorHistorial.innerHTML = `
                    <div class="header">
                        <h3>Historial de Reservas</h3>
                        <button class="btn-reiniciar">Resetear Todo</button>
                    </div>
                `;
            for (const reserva of reservas) {
                const div = document.createElement("div");
                div.classList.add("reserva");

                let habitacionesSpan = "";
                for (const h of reserva.habitaciones) {
                    habitacionesSpan += `<span class="${h.tipo.toLowerCase()}">${h.numero}</span>`;
                }

                div.innerHTML = `
                    <p class="nombre">${reserva.nombre}</p>
                    <p class="fecha">${reserva.entrada} - ${reserva.salida}</p>
                    <div class="habitaciones">
                        ${habitacionesSpan}
                    </div>
                    <p class="total-ref">$${reserva.total}</p>
                    <i class="fa-solid fa-trash eliminar-reserva" data-id="${reserva.nombre}-${reserva.entrada}-${reserva.salida}"></i>
                `;

                contenedorHistorial.appendChild(div);
            }
        }
        cargarDatos();


        function actualizarBarraStandard() {
            const total = 20;
            const ocupadas = habitacionesReservadas.filter(h => h.tipo == "Standard").length;
            const porcentaje = Math.round((ocupadas / total) * 100);

            const barra = document.querySelector(".barra.standard div");
            const detalle = document.querySelector(".categoria.standard .detalle");

            barra.style.width = `${porcentaje}%`;
            detalle.textContent = `${ocupadas} / ${total} (${porcentaje}%)`;
        }

        function actualizarBarraDeluxe() {
            const total = 15;
            const ocupadas = habitacionesReservadas.filter(h => h.tipo == "Deluxe").length;
            const porcentaje = Math.round((ocupadas / total) * 100);

            const barra = document.querySelector(".barra.deluxe div");
            const detalle = document.querySelector(".categoria.deluxe .detalle");

            barra.style.width = `${porcentaje}%`;
            detalle.textContent = `${ocupadas} / ${total} (${porcentaje}%)`;
        }

        function actualizarBarraSuite() {
            const total = 10;
            const ocupadas = habitacionesReservadas.filter(h => h.tipo == "Suite").length;
            const porcentaje = Math.round((ocupadas / total) * 100);

            const barra = document.querySelector(".barra.suite div");
            const detalle = document.querySelector(".categoria.suite .detalle");

            barra.style.width = `${porcentaje}%`;
            detalle.textContent = `${ocupadas} / ${total} (${porcentaje}%)`;
        }

        function actualizarBarraPresidencial() {
            const total = 5;
            const ocupadas = habitacionesReservadas.filter(h => h.tipo == "Presidencial").length;
            const porcentaje = Math.round((ocupadas / total) * 100);

            const barra = document.querySelector(".barra.presidencial div");
            const detalle = document.querySelector(".categoria.presidencial .detalle");

            barra.style.width = `${porcentaje}%`;
            detalle.textContent = `${ocupadas} / ${total} (${porcentaje}%)`;
        }

        actualizarBarraStandard();
        actualizarBarraDeluxe();
        actualizarBarraSuite();
        actualizarBarraPresidencial();






        contenedorHistorial.addEventListener("click", e => {
            if (e.target.classList.contains("eliminar-reserva")) {
                const id = e.target.dataset.id;

                const reservaEliminada = reservas.find(r => `${r.nombre}-${r.entrada}-${r.salida}` == id);
                console.log(reservaEliminada);
                if (!reservaEliminada)
                    return;

                const nuevasReservas = reservas.filter(r => `${r.nombre}-${r.entrada}-${r.salida}` != id);
                console.log(nuevasReservas);
                const nuevasHabitaciones = habitacionesReservadas
                    .filter(h => !reservaEliminada.habitaciones
                        .some(r => r.numero == h.numero));
                console.log(nuevasHabitaciones);

                localStorage.setItem("reservas", JSON.stringify(nuevasReservas));
                localStorage.setItem("habitacionesReservadas", JSON.stringify(nuevasHabitaciones));

                e.target.closest(".reserva").remove();

                // actualizarlas al momento de hacer una eliminacion (para simular el recargar la pagina)
                reservas.length = 0;
                reservas.push(...nuevasReservas);
                habitacionesReservadas.length = 0;
                habitacionesReservadas.push(...nuevasHabitaciones);

                actualizarBarraStandard();
                actualizarBarraDeluxe();
                actualizarBarraSuite();
                actualizarBarraPresidencial();

                cargarDatos();

                console.log(reservas);
                console.log(habitacionesReservadas);

            }
        });


        document.querySelector(".btn-reiniciar").addEventListener("click", () => {
            if (confirm("¿Seguro que quieres borrar todas las reservas y reiniciar el sistema?")) {
                localStorage.removeItem("reservas");
                localStorage.removeItem("habitacionesReservadas");

                actualizarBarraStandard();
                actualizarBarraDeluxe();
                actualizarBarraSuite();
                actualizarBarraPresidencial();

                cargarDatos();
            }
        });
    </script>
</body>
</html>
